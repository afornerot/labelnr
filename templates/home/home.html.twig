{% macro pa_evaluation(score) %}
    {% if score > 749 %}
        Raisonnable
    {% elseif score > 349 %}
        Partiel
    {% elseif score >= 0 %}
        Faible
    {% else %}
        NA
    {% endif %}
{% endmacro %}
{% import _self as macros %}

{% extends 'base.html.twig' %}

{%block localstyle%}
<style>
    verysmall {
        zoom:70%;
    }

    big {
        zoom: 130%;
    }

    surline {
        background-color: #fff;
        color: #000;
        padding:3px;
        display: block;
    }
</style>
{%endblock%}
{%block body%}
    SCORE = {{score|number_format(0)}}
    <div class="row">
        <table class="table table-striped table-bordered table-hover" style="width:100%">
            <thead>
                <tr>
                    <th>Axe</th>
                    <th>PA</th>
                </tr>
            </thead>     

            {% set currentthematic = "" %}
            {% for pa in pas %}
                {% set currentpa = "" %}
                <tr>
                    {%if currentthematic != pa.thematic.code %}
                        <td rowspan="{{pa.thematic.pas|length}}" style="text-align:center">
                            <center>
                                {{pa.thematic.code}}<br>
                                {{pa.thematic.title}}<br><br>
                            
                                <big>
                                    SCORE<br>
                                    {{pa.thematic.score|number_format(2)}}<br>
                                </big>

                                <verysmall>pondération = {{pa.thematic.length}}</verysmall><br>
                            </center>
                        </td>
                        {% set currentthematic = pa.thematic.code %}
                    {% endif %}

                    {%if currentpa != pa.code %}
                        <td>
                            {% set score=pa.score %}

                            <surline>{{pa.code}} = {{pa.title}}</surline><br>
                            Score = {{score|number_format(0)}}<br>
                            Evaluation = {{macros.pa_evaluation(score)}}<br>
                            <verysmall>
                                pondération = {{pa.tirs|length}}<br>
                                priorité = {{pa.materiality.title}}<br>
                            </verysmall>

                            <table class="table table-striped table-bordered table-hover" style="width:100%">
                                {% for tir in pa.tirs %}
                                    <tr>
                                        <td>{{ tir.code }}</td>
                                        <td>{{ tir.title }}</td>
                                        <td>{{ tir.maturity.title }}</td>
                                        <td>{{ tir.maturity.value }}</td>
                                    </tr>
                                {%endfor%}
                            </table>
                        </td>

                        {% set currentpa = pa.code %}
                    {% endif %}

                </tr>
            {% endfor %}
        </table>
    </div>
{%endblock%}

{% block localscript %}
<script>
    $(document).ready(function() {
    });     
</script>
{% endblock %}
